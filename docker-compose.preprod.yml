services:
    api:
      build:
        context: ./backend
        target: prod
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.api.rule=Host(`api.flepourtous.plouzor.fr`)"
        - "traefik.http.routers.api.entrypoints=web,websecure"
        - "traefik.http.routers.api.tls.certresolver=le"
        - "traefik.http.services.api.loadbalancer.server.port=80"
        - "traefik.docker.network=web"
      networks:
        - web
        - internal

    app:
        build:
          context: ./frontend
          dockerfile: dockerfile
          target: runner
        command: pnpm run start
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.app.rule=Host(`flepourtous.plouzor.fr`)"
            - "traefik.http.routers.app.entrypoints=web,websecure"
            - "traefik.http.routers.app.tls.certresolver=le"
            - "traefik.http.services.app.loadbalancer.server.port=3000"
            - "traefik.docker.network=web"
        networks:
          - web
          - internal

networks:
  web:
    external: true
    name: web
  internal:
    internal: true

